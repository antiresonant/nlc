<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NLC - Natural Language Compiler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(138, 101, 208, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 
                0 0 0 1px rgba(255, 255, 255, 0.1),
                0 20px 60px rgba(0, 0, 0, 0.4),
                0 0 100px rgba(99, 102, 241, 0.1);
            overflow: hidden;
            position: relative;
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .header h1 {
            font-size: 2.8em;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #ffffff 0%, #a5b4fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            font-size: 1.15em;
            opacity: 0.85;
            font-weight: 400;
            letter-spacing: 0.3px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }
        
        .input-panel, .output-panel {
            padding: 35px;
            display: flex;
            flex-direction: column;
        }
        
        .input-panel {
            border-right: 1px solid rgba(0, 0, 0, 0.06);
            background: linear-gradient(to bottom, #fafafa 0%, #ffffff 100%);
        }
        
        .output-panel {
            background: #ffffff;
        }
        
        .panel-header {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1a1a2e;
            letter-spacing: -0.3px;
        }
        
        .example-selector {
            margin-bottom: 18px;
        }
        
        .example-selector select {
            width: 100%;
            padding: 12px 16px;
            font-size: 0.95em;
            border: 1.5px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            color: #333;
        }
        
        .example-selector select:hover {
            border-color: rgba(99, 102, 241, 0.4);
        }
        
        .example-selector select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        textarea {
            flex: 1;
            padding: 18px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', 'Courier New', monospace;
            font-size: 13.5px;
            line-height: 1.6;
            border: 1.5px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            resize: none;
            margin-bottom: 18px;
            background: white;
            transition: all 0.2s ease;
            color: #1a1a2e;
        }
        
        textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        textarea::placeholder {
            color: #9ca3af;
        }
        
        .input-section {
            margin-bottom: 18px;
        }
        
        .input-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #1a1a2e;
            font-size: 0.9em;
            letter-spacing: -0.2px;
        }
        
        .input-section input[type="text"],
        .input-section input[type="password"] {
            width: 100%;
            padding: 12px 16px;
            font-size: 0.95em;
            border: 1.5px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            background: white;
            transition: all 0.2s ease;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        .input-section input[type="text"]:focus,
        .input-section input[type="password"]:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .input-section small {
            display: block;
            margin-top: 8px;
            color: #6b7280;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        .checkbox-section {
            margin-bottom: 20px;
            padding: 14px 16px;
            background: rgba(99, 102, 241, 0.04);
            border-radius: 12px;
            border: 1.5px solid rgba(99, 102, 241, 0.1);
            transition: all 0.2s ease;
        }
        
        .checkbox-section:hover {
            background: rgba(99, 102, 241, 0.06);
        }
        
        .checkbox-section label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.93em;
            color: #374151;
            font-weight: 500;
        }
        
        .checkbox-section input[type="checkbox"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #6366f1;
        }
        
        .api-key-section {
            display: none;
            margin-top: 14px;
            padding: 16px;
            background: rgba(251, 191, 36, 0.08);
            border-left: 3px solid #f59e0b;
            border-radius: 8px;
        }
        
        .api-key-section.visible {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .compile-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            font-size: 1.05em;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 14px rgba(99, 102, 241, 0.3),
                0 0 0 0 rgba(99, 102, 241, 0.4);
            letter-spacing: 0.3px;
        }
        
        .compile-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 24px rgba(99, 102, 241, 0.4),
                0 0 0 0 rgba(99, 102, 241, 0.4);
        }
        
        .compile-btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .compile-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-container {
            margin: 22px 0;
            display: none;
        }
        
        .progress-container.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.06);
            border-radius: 100px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 100px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShimmer 1.5s infinite;
        }
        
        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-status {
            margin-top: 12px;
            color: #6b7280;
            font-size: 0.9em;
            font-weight: 500;
            text-align: center;
        }
        
        .output-area {
            flex: 1;
            background: #1a1a2e;
            border-radius: 12px;
            padding: 24px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.7;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #e5e7eb;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .output-area.success {
            border-left: 3px solid #10b981;
        }
        
        .output-area.error {
            border-left: 3px solid #ef4444;
            color: #fca5a5;
        }
        
        .api-info {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(5, 150, 105, 0.08) 100%);
            border-left: 3px solid #10b981;
            padding: 14px 16px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-size: 0.9em;
            color: #065f46;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
        }
        
        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-panel {
                border-right: none;
                border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            }
        }
        
        .footer {
            text-align: center;
            padding: 24px;
            color: #9ca3af;
            font-size: 0.88em;
            border-top: 1px solid rgba(0, 0, 0, 0.06);
            background: #fafafa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ NLC Compiler</h1>
            <p>Write algorithms in plain English. Get working code. Like magic.</p>
        </div>
        
        <div class="main-content">
            <div class="input-panel">
                <div class="panel-header">üìù Your Algorithm</div>
                
                <div class="api-info">
                    ‚ú® <strong>Demo ready!</strong> Using author's API key. Start compiling immediately.
                </div>
                
                <div class="example-selector">
                    <select id="exampleSelect">
                        <option value="">-- Select an example --</option>
                        <option value="fibonacci">Fibonacci Calculator</option>
                        <option value="palindrome">Palindrome Checker</option>
                        <option value="prime">Prime Number Checker</option>
                        <option value="sort">List Sorter</option>
                        <option value="custom">Custom Algorithm</option>
                    </select>
                </div>
                
                <textarea id="algorithmInput" placeholder="BEGIN&#10;STEP 1: Describe what to do first&#10;STEP 2: Describe the next step&#10;STEP 3: Describe the final step&#10;END"></textarea>
                
                <div class="input-section">
                    <label for="testInput">Test Input (JSON format):</label>
                    <input type="text" id="testInput" placeholder='{"n": 10}' />
                </div>
                
                <div class="checkbox-section">
                    <label>
                        <input type="checkbox" id="useOwnKeyCheckbox" />
                        I want to use my own OpenAI API key
                    </label>
                    
                    <div class="api-key-section" id="apiKeySection">
                        <label for="apiKey" style="display: block; margin-bottom: 8px; font-weight: 600;">Your OpenAI API Key:</label>
                        <input type="password" id="apiKey" placeholder="sk-proj-..." style="width: 100%; padding: 10px; border: 2px solid #f59e0b; border-radius: 8px; margin-bottom: 8px;" />
                        <small style="color: #92400e;">üîí Your key stays in your browser, never stored. Get one free at <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #b45309; font-weight: 600;">OpenAI Platform</a></small>
                    </div>
                </div>
                
                <button class="compile-btn" id="compileBtn">‚ö° Compile & Run</button>
                
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-status" id="progressStatus">Initializing...</div>
                </div>
            </div>
            
            <div class="output-panel">
                <div class="panel-header">‚ú® Output</div>
                <div class="output-area" id="outputArea">Waiting for compilation...</div>
            </div>
        </div>
        
        <div class="footer">
            Built with OpenAI API ‚Ä¢ Powered by the NLC Framework
        </div>
    </div>

    <script>
        const examples = {
            fibonacci: {
                algorithm: `BEGIN
STEP 1: Take input number n
STEP 2: Calculate the nth Fibonacci number using iteration
STEP 3: Return the result
END`,
                input: '{"n": 10}'
            },
            palindrome: {
                algorithm: `BEGIN
STEP 1: Take input string text
STEP 2: Check if text reads the same forwards and backwards
STEP 3: Return true if palindrome, false otherwise
END`,
                input: '{"text": "racecar"}'
            },
            prime: {
                algorithm: `BEGIN
STEP 1: Take input number n
STEP 2: Check if n is divisible only by 1 and itself
STEP 3: Return true if prime, false otherwise
END`,
                input: '{"n": 17}'
            },
            sort: {
                algorithm: `BEGIN
STEP 1: Take input array of numbers
STEP 2: Sort the array in ascending order
STEP 3: Return the sorted array
END`,
                input: '{"numbers": [64, 34, 25, 12, 22, 11, 90]}'
            }
        };

        // Handle checkbox toggle
        document.getElementById('useOwnKeyCheckbox').addEventListener('change', (e) => {
            const apiKeySection = document.getElementById('apiKeySection');
            if (e.target.checked) {
                apiKeySection.classList.add('visible');
            } else {
                apiKeySection.classList.remove('visible');
            }
        });

        // Load saved API key from localStorage if available
        window.addEventListener('load', () => {
            const savedKey = localStorage.getItem('openai_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
            }
        });

        document.getElementById('exampleSelect').addEventListener('change', (e) => {
            const example = examples[e.target.value];
            if (example) {
                document.getElementById('algorithmInput').value = example.algorithm;
                document.getElementById('testInput').value = example.input;
            } else {
                document.getElementById('algorithmInput').value = '';
                document.getElementById('testInput').value = '';
            }
        });

        document.getElementById('compileBtn').addEventListener('click', async () => {
            const algorithm = document.getElementById('algorithmInput').value.trim();
            const testInput = document.getElementById('testInput').value.trim();
            const useOwnKey = document.getElementById('useOwnKeyCheckbox').checked;
            let apiKey = null;
            
            if (!algorithm) {
                alert('Please enter an algorithm!');
                return;
            }
            
            if (useOwnKey) {
                apiKey = document.getElementById('apiKey').value.trim();
                if (!apiKey) {
                    alert('Please enter your OpenAI API key or uncheck the box to use the demo key!');
                    return;
                }
                // Save API key to localStorage for convenience
                localStorage.setItem('openai_api_key', apiKey);
            }
            
            await compileAndRun(algorithm, testInput, apiKey);
        });

        async function compileAndRun(algorithm, testInput, userApiKey) {
            const btn = document.getElementById('compileBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressStatus = document.getElementById('progressStatus');
            const outputArea = document.getElementById('outputArea');
            
            btn.disabled = true;
            progressContainer.classList.add('active');
            outputArea.className = 'output-area';
            outputArea.textContent = '';
            
            try {
                // Parse test input
                let parsedInput = {};
                if (testInput) {
                    try {
                        parsedInput = JSON.parse(testInput);
                    } catch (e) {
                        throw new Error('Invalid JSON in test input');
                    }
                }
                
                // Step 1: Analyze algorithm
                updateProgress(20, 'Analyzing algorithm structure...');
                await sleep(500);
                
                // Step 2: Generate code with assertions
                updateProgress(40, 'Generating code with domain/range assertions...');
                const code = await generateCode(algorithm, userApiKey);
                await sleep(500);
                
                // Step 3: Verify assertions
                updateProgress(60, 'Verifying mathematical correctness...');
                await sleep(500);
                
                // Step 4: Execute code
                updateProgress(80, 'Executing compiled code...');
                const result = await executeCode(code, parsedInput);
                await sleep(300);
                
                // Step 5: Complete
                updateProgress(100, 'Compilation successful! ‚úì');
                await sleep(300);
                
                displaySuccess(code, result, parsedInput);
                
            } catch (error) {
                displayError(error.message);
            } finally {
                btn.disabled = false;
                setTimeout(() => {
                    progressContainer.classList.remove('active');
                    progressFill.style.width = '0%';
                }, 2000);
            }
        }

        async function generateCode(algorithm, userApiKey) {
            // If user provided their own key, use it directly
            if (userApiKey) {
                return await callOpenAI(algorithm, userApiKey);
            }
            
            // Otherwise, use Netlify Function with author's key
            try {
                const response = await fetch('/.netlify/functions/compile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ algorithm })
                });

                if (!response.ok) {
                    throw new Error('Failed to generate code');
                }

                const data = await response.json();
                return data.code;
            } catch (error) {
                throw new Error(`Compilation error: ${error.message}`);
            }
        }

        async function callOpenAI(algorithm, apiKey) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o',
                    messages: [{
                        role: 'system',
                        content: 'You are the NLC (Natural Language Compiler). You convert algorithms into executable JavaScript code following the NLC framework with domain/range assertions. You return ONLY executable JavaScript code, no explanations, no markdown formatting.'
                    }, {
                        role: 'user',
                        content: `Convert this algorithm into executable JavaScript code following the NLC framework with domain/range assertions.

Algorithm:
${algorithm}

Requirements:
1. Parse the algorithm steps
2. Generate a single JavaScript function that implements ALL steps
3. The function MUST be named 'nlcCompiled'
4. Include proper error handling and type checking (domain assertions)
5. Return ONLY the function code, nothing else - no explanations, no markdown
6. The function should accept an object with named parameters
7. Make it production-ready and deterministic

Return ONLY the JavaScript function code with no formatting.`
                    }],
                    temperature: 0.1
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'Failed to generate code');
            }

            const data = await response.json();
            let code = data.choices[0].message.content;
            
            // Clean up any markdown formatting
            code = code.replace(/```javascript\n?/g, '').replace(/```\n?/g, '').trim();
            
            return code;
        }

        async function executeCode(code, input) {
            try {
                // Create a safe execution context
                const func = new Function('input', `
                    ${code}
                    return nlcCompiled(input);
                `);
                
                const result = func(input);
                return result;
            } catch (error) {
                throw new Error(`Execution error: ${error.message}`);
            }
        }

        function updateProgress(percent, status) {
            const progressFill = document.getElementById('progressFill');
            const progressStatus = document.getElementById('progressStatus');
            
            progressFill.style.width = percent + '%';
            progressStatus.textContent = status;
        }

        function displaySuccess(code, result, input) {
            const outputArea = document.getElementById('outputArea');
            outputArea.className = 'output-area success';
            
            let output = '‚úì COMPILATION SUCCESSFUL\n\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            output += 'GENERATED CODE:\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            output += code;
            output += '\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            output += 'EXECUTION RESULT:\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            output += `Input: ${JSON.stringify(input, null, 2)}\n\n`;
            output += `Output: ${JSON.stringify(result, null, 2)}\n`;
            
            outputArea.textContent = output;
        }

        function displayError(message) {
            const outputArea = document.getElementById('outputArea');
            outputArea.className = 'output-area error';
            outputArea.textContent = `‚úó COMPILATION FAILED\n\n${message}`;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
